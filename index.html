<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–Ω–ª–∞–π–Ω-—á–∞—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            margin: 0;
            padding: 20px;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .welcome-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .welcome-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--tg-theme-text-color, #000);
        }
        
        .welcome-subtitle {
            font-size: 16px;
            color: var(--tg-theme-hint-color, #666);
            margin-bottom: 30px;
            line-height: 1.4;
        }
        
        .start-button {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, white);
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,136,204,0.3);
        }
        
        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,136,204,0.4);
        }
        
        .start-button:active {
            transform: translateY(0);
        }
        
        .features {
            margin-top: 30px;
            text-align: left;
        }
        
        .feature {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 14px;
            color: var(--tg-theme-hint-color, #666);
        }
        
        .feature-icon {
            margin-right: 10px;
            font-size: 16px;
        }
        
        .loading {
            display: none;
            margin-top: 20px;
            color: var(--tg-theme-hint-color, #666);
        }
        
        .error-message {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #ffebee;
            color: #c62828;
            border-radius: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="welcome-container">
        <div class="logo">üí¨</div>
        <h1 class="welcome-title">–í—ñ—Ç–∞—î–º–æ –≤ –æ–Ω–ª–∞–π–Ω-—á–∞—Ç—ñ!</h1>
        <p class="welcome-subtitle">
            –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —à–≤–∏–¥–∫—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É –≤—ñ–¥ –Ω–∞—à–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ.
        </p>
        
        <button class="start-button" onclick="startChat()" id="startButton">
            –ü–æ—á–∞—Ç–∏ —á–∞—Ç
        </button>
        
        <div class="loading" id="loading">
            –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —á–∞—Ç—É...
        </div>
        
        <div class="error-message" id="errorMessage">
            –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –±–æ—Ç–∞.
        </div>
        
        <div class="features">
            <div class="feature">
                <span class="feature-icon">‚ö°</span>
                <span>–ú–∏—Ç—Ç—î–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</span>
            </div>
            <div class="feature">
                <span class="feature-icon">üîí</span>
                <span>–ó–∞—Ö–∏—â–µ–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è</span>
            </div>
            <div class="feature">
                <span class="feature-icon">üì±</span>
                <span>–ü—Ä–∞—Ü—é—î –≤ Telegram</span>
            </div>
            <div class="feature">
                <span class="feature-icon">üë•</span>
                <span>–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞</span>
            </div>
        </div>
    </div>

    <script>
        console.log('–ü–æ—á–∞—Ç–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è index.html...');
        console.log('window.Telegram:', window.Telegram);
        
        // –ß–µ–∫–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Telegram API
        function waitForTelegram(callback, attempts = 0) {
            if (attempts > 10) {
                console.error('Telegram WebApp API –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è –ø—ñ—Å–ª—è 10 —Å–ø—Ä–æ–±');
                showError('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Telegram WebApp API. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –±–æ—Ç–∞ –∞–±–æ –æ–Ω–æ–≤–∏—Ç–∏ Telegram.');
                return;
            }
            
            if (window.Telegram && window.Telegram.WebApp) {
                console.log('Telegram WebApp API –∑–Ω–∞–π–¥–µ–Ω–æ!');
                callback();
            } else {
                console.log(`–°–ø—Ä–æ–±–∞ ${attempts + 1}: –û—á—ñ–∫—É—î–º–æ Telegram API...`);
                setTimeout(() => waitForTelegram(callback, attempts + 1), 500);
            }
        }
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        waitForTelegram(() => {
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            console.log('Telegram WebApp —É—Å–ø—ñ—à–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ!');
            
            initWelcome();
        });
        
        function initWelcome() {
            console.log('–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—ñ—Ç–∞–ª—å–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏...');
            
            const user = window.Telegram.WebApp.initDataUnsafe?.user;
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            const chatId = urlParams.get('chat_id');
            
            // –ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑—É—î–º–æ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è
            if (user && user.first_name) {
                const title = document.querySelector('.welcome-title');
                title.textContent = `–ü—Ä–∏–≤—ñ—Ç, ${user.first_name}!`;
                
                const subtitle = document.querySelector('.welcome-subtitle');
                subtitle.textContent = '–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —à–≤–∏–¥–∫—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É –≤—ñ–¥ –Ω–∞—à–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± –ø–æ—á–∞—Ç–∏ —á–∞—Ç.';
            }
            
            console.log('–î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:', { user, userId, chatId });
        }
        
        function startChat() {
            console.log('–ü–æ—á–∞—Ç–æ–∫ —á–∞—Ç—É...');
            
            const startButton = document.getElementById('startButton');
            const loading = document.getElementById('loading');
            
            // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            startButton.style.display = 'none';
            loading.style.display = 'block';
            
            // –û—Ç—Ä–∏–º—É—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');
            const chatId = urlParams.get('chat_id');
            const user = window.Telegram.WebApp.initDataUnsafe?.user;
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ
            if (!userId || !chatId) {
                showError('–ü–æ–º–∏–ª–∫–∞: –≤—ñ–¥—Å—É—Ç–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —á–∞—Ç—É. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –±–æ—Ç–∞.');
                return;
            }
            
            try {
                // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ —á–∞—Ç—É
                const data = {
                    action: 'start_chat',
                    user_id: userId,
                    chat_id: chatId,
                    username: user?.username || '–Ω–µ–≤—ñ–¥–æ–º–æ',
                    first_name: user?.first_name || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á',
                    timestamp: new Date().toISOString()
                };
                
                console.log('–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø–æ—á–∞—Ç–æ–∫ —á–∞—Ç—É:', data);
                window.Telegram.WebApp.sendData(JSON.stringify(data));
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —á–∞—Ç—É
                setTimeout(() => {
                    window.location.href = 'chat.html' + window.location.search;
                }, 1000);
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø–æ—á–∞—Ç–∫—É —á–∞—Ç—É:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —á–∞—Ç—É. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
            }
        }
        
        function showError(message) {
            const startButton = document.getElementById('startButton');
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');
            
            startButton.style.display = 'inline-block';
            loading.style.display = 'none';
            errorMessage.style.display = 'block';
            errorMessage.textContent = message;
        }
        
        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–º–∏ Telegram
        function applyTelegramTheme() {
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.colorScheme) {
                document.body.classList.add(`theme-${window.Telegram.WebApp.colorScheme}`);
            }
        }
        
        // –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ —Ç–µ–º–∏
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.onEvent('themeChanged', () => {
                document.body.className = '';
                applyTelegramTheme();
            });
        }
        
        // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        setTimeout(applyTelegramTheme, 100);
        
        console.log('Index.html —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!');
    </script>
</body>
</html>
