<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí¨ –ß–∞—Ç –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            padding: 15px;
            border-bottom: 1px solid var(--tg-theme-hint-color, #ccc);
            text-align: center;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .message.user {
            background: var(--tg-theme-button-color, #007AFF);
            color: var(--tg-theme-button-text-color, #ffffff);
            margin-left: auto;
            text-align: right;
        }
        
        .message.admin {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            color: var(--tg-theme-text-color, #000000);
            margin-right: auto;
        }
        
        .input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid var(--tg-theme-hint-color, #ccc);
            background: var(--tg-theme-bg-color, #ffffff);
        }
        
        .message-input {
            flex: 1;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 20px;
            padding: 10px 15px;
            margin-right: 10px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        
        .send-button {
            background: var(--tg-theme-button-color, #007AFF);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }
        
        .status {
            text-align: center;
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="chat-header">
        <h3>üí¨ –ß–∞—Ç –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é</h3>
        <div class="status" id="status">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</div>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="message admin">
            –í—ñ—Ç–∞—î–º–æ! –Ø–∫ –º–æ–∂–µ–º–æ –¥–æ–ø–æ–º–æ–≥—Ç–∏?
            <div style="font-size: 12px; color: #666; margin-top: 5px;">–ó–∞—Ä–∞–∑</div>
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" class="message-input" id="messageInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." maxlength="1000">
        <button class="send-button" id="sendButton" onclick="sendMessage()">üì§</button>
    </div>
    
    <script>
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Telegram WebApp
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
        
        // –û—Ç—Ä–∏–º—É—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id');
        const chatId = urlParams.get('chat_id');
        
        console.log('User ID:', userId, 'Chat ID:', chatId);
        
        if (!userId || !chatId) {
            document.getElementById('status').textContent = '–ü–æ–º–∏–ª–∫–∞: –≤—ñ–¥—Å—É—Ç–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏';
        } else {
            document.getElementById('status').textContent = '–ì–æ—Ç–æ–≤–æ –¥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è';
        }
        
        // –û–±—Ä–æ–±–∫–∞ Enter –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message) return;
            
            if (!userId || !chatId) {
                alert('–ü–æ–º–∏–ª–∫–∞: –≤—ñ–¥—Å—É—Ç–Ω—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏');
                return;
            }
            
            // –î–æ–¥–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç
            addMessageToChat('user', message);
            messageInput.value = '';
            
            // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ Telegram
            const tgUser = window.Telegram.WebApp.initDataUnsafe?.user;
            
            // –§–æ—Ä–º—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
            const dataToSend = {
                action: 'send_message',
                user_id: parseInt(userId),
                chat_id: parseInt(chatId),
                message: message,
                username: tgUser?.username || '–Ω–µ–≤—ñ–¥–æ–º–æ',
                first_name: tgUser?.first_name || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'
            };
            
            console.log('–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –¥–∞–Ω—ñ:', dataToSend);
            
            // –û–°–ù–û–í–ù–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Telegram WebApp API –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–∏—Ö
            window.Telegram.WebApp.sendData(JSON.stringify(dataToSend));
        }
        
        function addMessageToChat(sender, message) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('uk-UA', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                ${message}
                <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">${timeStr}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // –û–±—Ä–æ–±–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –≤—ñ–¥ –±–æ—Ç–∞ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
        window.Telegram.WebApp.onEvent('webAppDataSent', function() {
            console.log('–î–∞–Ω—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–æ –±–æ—Ç–∞');
        });
        
        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä–æ–≤–æ—ó —Å—Ö–µ–º–∏
        document.documentElement.style.setProperty('--tg-theme-bg-color', window.Telegram.WebApp.themeParams.bg_color || '#ffffff');
        document.documentElement.style.setProperty('--tg-theme-text-color', window.Telegram.WebApp.themeParams.text_color || '#000000');
        document.documentElement.style.setProperty('--tg-theme-button-color', window.Telegram.WebApp.themeParams.button_color || '#007AFF');
    </script>
</body>
</html>
